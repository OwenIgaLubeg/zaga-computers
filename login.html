<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zaga Technologies - Login</title>

    <!-- Bootstrap & Fonts -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/v4-shims.css">

    <style>
        body {
          background: linear-gradient(to right, #007bff, #6610f2);
          font-family: "Poppins", sans-serif;
          margin: 0;
          padding-top: 80px;
        }
        .login-container {
          max-width: 900px;
          margin: 50px auto;
          display: flex;
          gap: 30px;
          flex-wrap: wrap;
          justify-content: center;
        }
        .login-card {
          background: #fff;
          border-radius: 15px;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
          padding: 40px;
          width: 100%;
          max-width: 420px;
          text-align: center;
          animation: fadeInUp 0.6s ease;
        }
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .login-card h3 {
          font-weight: 700;
          margin-bottom: 20px;
        }
        .admin-card h3 {
          color: #dc3545;
        }
        .user-card h3 {
          color: #007bff;
        }
        .form-control {
          border-radius: 25px;
          padding: 10px 20px;
        }
        .btn-login {
          border-radius: 25px;
          font-weight: 600;
          transition: all 0.3s ease;
          color: white;
        }
        .btn-admin {
          background-color: #dc3545;
        }
        .btn-admin:hover {
          background-color: #c82333;
          transform: translateY(-2px);
        }
        .btn-user {
          background-color: #007bff;
        }
        .btn-user:hover {
          background-color: #0056b3;
          transform: translateY(-2px);
        }
        .error-message {
          color: red;
          font-size: 0.9rem;
          margin-top: 10px;
          display: none;
        }
        .success-message {
          color: green;
          font-size: 0.9rem;
          margin-top: 10px;
          display: none;
        }
        .toggle-link {
          margin-top: 15px;
          color: #007bff;
          cursor: pointer;
          text-decoration: underline;
        }
        .toggle-link:hover {
          color: #0056b3;
        }
        @media (max-width: 768px) {
          .login-container {
            flex-direction: column;
          }
        }
    </style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white py-3 fixed-top">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="index.html">
            <img src="./img/zaga-logo.jpg" alt="ZAGA Technologies Logo" style="height: 40px; width: auto; margin-right: 8px;">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span><i id="bar" class="fas fa-bars"></i></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="shop.html">Our Store</a></li>
                <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
                <li class="nav-item"><a class="nav-link" href="contact.html">Contact Us</a></li>
                <li class="nav-item"><a class="nav-link" href="blog.html">Blogs</a></li>
                <li class="nav-item"><a class="nav-link active" href="login.html">Sign-In/Up</a></li>
                <li class="nav-item d-flex align-items-center">
                    <a href="cart.html" class="cart-link ms-2" title="View Cart"><i class="fas fa-shopping-bag"></i></a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Login Cards Container -->
<div class="login-container">
    
    <!-- ADMIN LOGIN CARD -->
    <div class="login-card admin-card">
        <h3><i class="fas fa-user-shield"></i> Admin Login</h3>
        <form id="adminLoginForm">
            <div class="mb-3">
                <input type="email" class="form-control" id="adminEmail" placeholder="Admin Email" required />
            </div>
            <div class="mb-3">
                <input type="password" class="form-control" id="adminPassword" placeholder="Password" required />
            </div>
            <button type="submit" class="btn btn-login btn-admin w-100 mt-2">Login as Admin</button>
            <p id="adminErrorMsg" class="error-message">Invalid credentials. Please try again.</p>
        </form>
    </div>

    <!-- USER LOGIN/REGISTER CARD -->
    <div class="login-card user-card">
        <h3 id="userFormTitle"><i class="fas fa-user"></i> User Login</h3>
        
        <!-- User Login Form -->
        <form id="userLoginForm">
            <div class="mb-3">
                <input type="email" class="form-control" id="userEmail" placeholder="Email" required />
            </div>
            <div class="mb-3">
                <input type="password" class="form-control" id="userPassword" placeholder="Password" required />
            </div>
            <button type="submit" class="btn btn-login btn-user w-100 mt-2">Login</button>
            <p id="userErrorMsg" class="error-message">Invalid credentials. Please try again.</p>
            <p id="userSuccessMsg" class="success-message">Account created successfully! Please login.</p>
        </form>

        <!-- User Registration Form (hidden by default) -->
        <form id="userRegisterForm" style="display: none;">
            <div class="mb-3">
                <input type="text" class="form-control" id="registerName" placeholder="Full Name" required />
            </div>
            <div class="mb-3">
                <input type="email" class="form-control" id="registerEmail" placeholder="Email" required />
            </div>
            <div class="mb-3">
                <input type="password" class="form-control" id="registerPassword" placeholder="Password (min 6 characters)" required minlength="6" />
            </div>
            <div class="mb-3">
                <input type="password" class="form-control" id="registerConfirmPassword" placeholder="Confirm Password" required minlength="6" />
            </div>
            <button type="submit" class="btn btn-login btn-user w-100 mt-2">Create Account</button>
            <p id="registerErrorMsg" class="error-message">Please check your information and try again.</p>
        </form>

        <!-- Toggle between Login and Register -->
        <p class="toggle-link" id="toggleFormLink">Don't have an account? Sign up here</p>
    </div>

</div>

<!-- Footer -->
<footer class="mt-5 py-5">
    <div class="row container mx-auto pb-5">
        <div class="footer-one col-lg-3 col-md-6 col-12">
            <h5>ZAGA-Technologies</h5>
            <p class="pt-3">ZAGA-Technologies is one of Uganda's leading independent retailers of laptops, printers
                and Desktops Computers. We stock hundreds of products from the big brands like lenovo, Hp, Dell and
                Microsoft all at the best prices.</p>
        </div>
        <div class="footer-one col-lg-3 col-md-6 col-12 mb-3">
            <h5 class="pb-2">Quik links</h5>
            <ul class="text-uppercase list-unstyled">
                <li><a href="shop.html">Our store</a></li>
                <li><a href="cart.html">Cart</a></li>
                <li><a href="about.html">About Us</a></li>
                <li><a href="contact.html">Contact Us</a></li>
            </ul>
        </div>
        <div class="footer-one col-lg-3 col-md-6 col-12 mb-3">
            <h5 class="pb-2">Contact Us</h5>
            <div>
                <h6 class="text-uppercase">Address</h6>
                <p>Kabaka kintu House Level- 1 shop No: C-03</p>
                <p>opp king Fahad plaza - Kampala rd.</p>
            </div>
            <div>
                <h6 class="text-uppercase">Phone</h6>
                <p>+256 700706809</p>
            </div>
            <div>
                <h6 class="text-uppercase">Email</h6>
                <p>sales2.zagatechnologiesltd@gmail.com</p>
            </div>
        </div>
        <div class="footer-one col-lg-3 col-md-6 col-12">
            <h5 class="pb-2">Brand Partners</h5>
            <div class="row">
                <img class="img-fluid w-25 h-100 m-2"src="img/brand/apple.png" alt="">
                <img class="img-fluid w-25 h-100 m-2"src="img/brand/samsung.png" alt="">
                <img class="img-fluid w-25 h-100 m-2"src="img/brand/hp%20logo.png" alt="">
                <img class="img-fluid w-25 h-100 m-2"src="img/brand/dell.png" alt="">
                <img class="img-fluid w-25 h-100 m-2"src="img/brand/lenovo.png" alt="">
            </div>
        </div>
    </div>

    <div class="copyright mt-5">
        <div class="row container mx-auto">
            <div class="col-lg-3 col-md-6 col-12 mb-4">
                <img src="img/payment.png" alt="">
            </div>
            <div class="col-lg-4 col-md-6 col-12 text-nowrap mb-2">
                <p>Zaga Technologies Â© 2025. All Rights Reserved </p>
            </div>
            <div class="col-lg-4 col-md-6 col-12">
                <a href=""><i class="fab fa-facebook-f"></i></a>
                <a href=""><i class="fab fa-instagram"></i></a>
                <a href=""><i class="fab fa-tiktok"></i></a>
            </div>
        </div>
    </div>
</footer>

<!-- Firebase Authentication Script -->
<script type="module">
    import { auth, db, firebaseConfig } from "./js/firebase-config.js";
    import { signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const ADMIN_EMAIL = 'sales2.zagatechnologiesltd@gmail.com';
    const ADMIN_PASSWORD = '@karenlivs2';

    // Form elements
    const adminLoginForm = document.getElementById('adminLoginForm');
    const userLoginForm = document.getElementById('userLoginForm');
    const userRegisterForm = document.getElementById('userRegisterForm');
    const toggleFormLink = document.getElementById('toggleFormLink');
    const userFormTitle = document.getElementById('userFormTitle');

    // Error message elements
    const adminErrorMsg = document.getElementById('adminErrorMsg');
    const userErrorMsg = document.getElementById('userErrorMsg');
    const registerErrorMsg = document.getElementById('registerErrorMsg');
    const userSuccessMsg = document.getElementById('userSuccessMsg');

    // Check if user is already logged in
    onAuthStateChanged(auth, (user) => {
        if (user) {
            if (user.email === ADMIN_EMAIL) {
                window.location.href = 'admin-dashboard.html';
            } else {
                window.location.href = 'shop.html';
            }
        }
    });

    // Admin Login
    adminLoginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('adminEmail').value.trim();
        const password = document.getElementById('adminPassword').value.trim();

        // Validate admin credentials
        if (email !== ADMIN_EMAIL || password !== ADMIN_PASSWORD) {
            adminErrorMsg.textContent = 'Invalid admin credentials!';
            adminErrorMsg.style.display = 'block';
            return;
        }

        try {
            await signInWithEmailAndPassword(auth, email, password);
            localStorage.setItem('adminLoggedIn', 'true');
            localStorage.setItem('userRole', 'admin');
            window.location.href = 'admin-dashboard.html';
        } catch (error) {
            // If admin account doesn't exist, show helpful message
            if (error.code === 'auth/user-not-found') {
                adminErrorMsg.textContent = 'Admin account not set up. Please contact system administrator.';
            } else {
                adminErrorMsg.textContent = error.message;
            }
            adminErrorMsg.style.display = 'block';
        }
    });

    // User Login
    userLoginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('userEmail').value.trim();
        const password = document.getElementById('userPassword').value.trim();

        try {
            await signInWithEmailAndPassword(auth, email, password);
            localStorage.setItem('userLoggedIn', 'true');
            localStorage.setItem('userRole', 'user');
            window.location.href = 'shop.html';
        } catch (error) {
            userErrorMsg.textContent = error.message;
            userErrorMsg.style.display = 'block';
            setTimeout(() => { userErrorMsg.style.display = 'none'; }, 5000);
        }
    });

    // User Registration
    userRegisterForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('registerName').value.trim();
        const email = document.getElementById('registerEmail').value.trim();
        const password = document.getElementById('registerPassword').value.trim();
        const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();

        // Validate passwords match
        if (password !== confirmPassword) {
            registerErrorMsg.textContent = 'Passwords do not match!';
            registerErrorMsg.style.display = 'block';
            return;
        }

        // Prevent admin email registration
        if (email === ADMIN_EMAIL) {
            registerErrorMsg.textContent = 'This email is reserved for admin use.';
            registerErrorMsg.style.display = 'block';
            return;
        }

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            // Create user profile in Firestore
            await setDoc(doc(db, 'users', user.uid), {
                name: name,
                email: email,
                createdAt: new Date(),
                role: 'customer'
            });

            // Show success message and switch back to login
            userSuccessMsg.style.display = 'block';
            userRegisterForm.reset();
            setTimeout(() => {
                toggleForm();
                userSuccessMsg.style.display = 'none';
            }, 2000);

        } catch (error) {
            registerErrorMsg.textContent = error.message;
            registerErrorMsg.style.display = 'block';
            setTimeout(() => { registerErrorMsg.style.display = 'none'; }, 5000);
        }
    });

    // Toggle between login and registration forms
    function toggleForm() {
        const isLoginVisible = userLoginForm.style.display !== 'none';
        
        if (isLoginVisible) {
            userLoginForm.style.display = 'none';
            userRegisterForm.style.display = 'block';
            userFormTitle.innerHTML = '<i class="fas fa-user-plus"></i> Create Account';
            toggleFormLink.textContent = 'Already have an account? Login here';
        } else {
            userLoginForm.style.display = 'block';
            userRegisterForm.style.display = 'none';
            userFormTitle.innerHTML = '<i class="fas fa-user"></i> User Login';
            toggleFormLink.textContent = "Don't have an account? Sign up here";
        }
        
        // Hide all error messages
        userErrorMsg.style.display = 'none';
        registerErrorMsg.style.display = 'none';
        userSuccessMsg.style.display = 'none';
    }

    toggleFormLink.addEventListener('click', toggleForm);
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
</body>
</html>
